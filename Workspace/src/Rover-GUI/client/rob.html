
<!DOCTYPE html>
<html lang="en">
<head>
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Robot</title>
<meta charset="utf-8" />
<script src="../components/roslib.min.js"></script>
<script src="../components/EventEmitter2.js"></script>
<script src="../components/Ros.js"></script>
<script src="../components/RosLib.js"></script>
<link rel="stylesheet" type="text/css" href="../components/main.css">
<script src="../node_modules/react/react.js"></script>
<script src="../node_modules/react/lib/react.min.js"></script>
<script src="../node_modules/react/lib/react-dom.min.js"></script>
<script src="../node_modules/react/lib/browser.min.js"></script>

<link rel="stylesheet" href="leaflet/leaflet.css"/>
<script src="leaflet/leaflet.js"></script>
<script src="map.js"></script>

<script src = "js/three.min.js"></script>
<script src = "js/THREE.MeshLine.js"></script>

<style>
  #map{
    height: 100%;
  }
</style>

</head>

<body onLoad = "onLoad();">
  <div id="background">
  <img src="../components/logo.jpg" height="100">
  <!--
  <div class="instruction">
  <p>Run the following commands in the terminal then refresh this page.</p>
  <ol>
    <li><tt>roscore</tt></li>
    <li><tt>roslaunch rosbridge_server rosbridge_websocket.launch</tt></li>
  </ol>
  </div>
-->
  <div id="statusIndicator">
    <p id="connecting">
      Connecting to rosbridge...
    </p>
    <p id="connected" style="color:#00D600; display:none">
      Connected
    </p>
    <p id="error" style="color:#FF0000; display:none">
      Error in the backend!
    </p>
    <p id="closed" style="display:none">
      Connection closed.
    </p>
  </div>
  <div id="container"></div>
  </div>

<div class="imuContainer">
  <div id="imu" style="height:400px; width:800px; background-color:#000000">
  </div>
  </div>

  <div class="mapContainer">
    <div id="map"; style="width:1100px; height: 400px;";></div>
    <script>
      var map = init();
    </script>
      Lat:
      <input type="text" id="LatF" value="43.46">

      Long:
      <input type="text" id="LongF" value="-80.52">
    <button type="button" onclick="addMarker()">Add Marker</button>

    <input type="checkbox" id="followBox">Follow Rover<br>
  </div>

  <script>


  var scene, camera, renderer;
  var geometry, material, mesh, group;
  function onLoad(){
    var container = document.getElementById("imu");

    var posx = 0;
    var posy = 0;
    var posz = 0;

    renderer = new THREE.WebGLRenderer();
    renderer.setSize(container.offsetWidth, container.offsetHeight);
    container.appendChild(renderer.domElement);

    scene = new THREE.Scene();

    camera = new THREE.PerspectiveCamera(45, container.offsetWidth/container.offsetHeight, 1, 1000);
    camera.position.set(1,2,5);
    camera.lookAt(new THREE.Vector3(posx,posy,posz));
    scene.add(camera);
    var textureLoader = new THREE.TextureLoader();
    var onload = function(texture){renderer.render(scene,camera);};
    var texture0 = textureLoader.load('1.png',onload);
    var texture1 = textureLoader.load('2.png',onload);
      var  materials = [
             new THREE.MeshLambertMaterial( {  } ),
           new THREE.MeshLambertMaterial( {   } ),
           new THREE.MeshBasicMaterial( { map: texture0 } ),
           new THREE.MeshBasicMaterial( { map: texture1  } ),
           new THREE.MeshLambertMaterial( {   } ),
           new THREE.MeshLambertMaterial( {   } )];
    var faceMaterial = new THREE.MultiMaterial( materials );

    var geometry = new THREE.BoxBufferGeometry(1.5,1,2.8);//,5,5,5);
    var mainbox = new THREE.Mesh(geometry,faceMaterial);// new THREE.MeshLambertMaterial({}));//({ color: 0xff0000, wireframe: true } ) );

    //var mainbox = new THREE.Mesh(geometry, new THREE.MeshLambertMaterial({}));//({ color: 0xff0000, wireframe: true } ) );
    group = new THREE.Group();
    group.position.x = posx;
    group.position.y = posy;
    group.position.z = posz;
    group.add(mainbox);
    scene.add(group);
    renderer.render(scene,camera);
    /*/Adding the ground
    var material = new THREE.MeshBasicMaterial( {color: 0xffff00, side: THREE.DoubleSide} );
    var ground = new THREE.Mesh(new THREE.PlaneGeometry(200,200),material);
    ground.position.y = -1.9; //lower it
    ground.rotation.x = -Math.PI/2; //-90 degrees around the xaxis
    scene.add(ground);
    */

    //Adding some coole things
    var grid = new THREE.GridHelper( 40, 80 );
    grid.setColors( 0xffffff, 0xffffff );
    scene.add(grid);

    scene.fog = new THREE.FogExp2( 0xffffff, 0.089 );
    renderer.setClearColor( scene.fog.color, 1 );

    var linmat = new THREE.LineBasicMaterial({ color: 0xff0000 });
    /*var linmat2 = new MeshLineMaterial(
            {
                  color: new THREE.Color( 0xff0000 ),
                  opacity: 1,
                  lineWidth: 0.02
            });*/
    //var linegeo = new THREE.BufferGeometry();
    var vertices = new Float32Array([
            0,	-4,	0,
            0,	4,	0,
            0,	-4, 0]);

    var geometry = new THREE.Geometry();
    geometry.vertices.push(
            new THREE.Vector3(0, -10, 0 ),
            new THREE.Vector3( 0, 10, 0 ));


    //var g = new MeshLine();
    //g.setGeometry(geometry);
    //linegeo.addAttribute( 'position', new THREE.BufferAttribute( vertices, 3 ) );
    //var line = new THREE.Mesh(g.geometry,linmat2);
    var line = new THREE.Line(geometry,linmat);
    scene.add(line);



    // add subtle ambient lighting
        var ambientLight = new THREE.AmbientLight(0x0c0c0c);
        scene.add(ambientLight);

        // add spotlight for the shadows
        var spotLight = new THREE.SpotLight(0xffffff);
        spotLight.position.set(container.offsetWidth/2, container.offsetHeight/2,60);//(-30, 60, 60);
        spotLight.castShadow = true;
        scene.add(spotLight);
    var potLight = new THREE.SpotLight(0xffffff,0.5);
          potLight.position.set(-30, 60, 60);
    potLight.castShadow = true;
    scene.add(potLight);

    renderer.render(scene, camera);
     //rotate(0,-0.1,0);

  }

  document.onkeydown = function(evt) {
      evt = evt || window.event;
      if (evt.keyCode == 39) {
          //right
          rotate(0,0.1,0);
      }else if(evt.keyCode == 37){
          //left
          rotate(0,-0.1,0);
      }
      if (evt.keyCode == 38){
          //up
          rotate(-0.1,0,0);
      }else if (evt.keyCode == 40){
          //down
          rotate(0.1,0,0);
      }
  };

  function rotate(x, y, z){
      //requestAnimationFrame(animate);
    group.rotation.x += x;
    group.rotation.y += y;
    group.rotation.z += z;
    renderer.render( scene, camera );
  }

  </script>

  <script src="../dist/bundle.js"></script>


</body>
</html>
