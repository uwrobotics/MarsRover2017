variables:
  ROS_DISTRO: "kinetic"
  CI_SOURCE_PATH: "$CI_PROJECT_DIR"
  ROS_PARALLEL_JOBS: "-j8 -l6"

before_script:
# before install
  - mkdir -p ~/catkin_ws/src
  - cd ~/catkin_ws/src
  - if [ ! -f CMakeLists.txt ]; then catkin_init_workspace; else echo "CMakeList file already there";fi
  - if [ ! -f .rosinstall ]; then wstool init; else echo "rosinstall file already there";fi
  - if [ -f $CI_PROJECT_NAME ]; then rm $CI_PROJECT_NAME; else echo "no past symlink";fi
  - ln -s $CI_SOURCE_PATH .
# install
  - cd ~/catkin_ws/src
  - if [ ! -f .rosinstall ]; then wstool init; else echo "rosinstall file already there";fi
  - if [[ -f $ROSINSTALL_FILE ]] ; then wstool merge $ROSINSTALL_FILE ; fi
  - wstool up
  - cd ~/catkin_ws
  - ls -a
# This is if you configure your rosdep correctly
  # - rosdep install -y --from-paths src --ignore-src --rosdistro $ROS_DISTRO

kinetic-master:
  stage: build
  script:
    - source /opt/ros/$ROS_DISTRO/setup.bash
    - cd ~/catkin_ws
    - catkin_make $( [ -f $CATKIN_OPTIONS ] && cat $CATKIN_OPTIONS )
    - source devel/setup.bash
    - catkin_make run_tests && catkin_make test
    - echo "Done with the test"
  only:
    - master
  tags:
    - ros